<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>זיהוי דיבור בלייב</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #transcript {
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>זיהוי דיבור בלייב</h1>
    <div id="transcript"></div>
    <script>
        const transcriptDiv = document.getElementById('transcript');
        let recognition;
        let recognitionActive = false;

        const contacts = ['נעם שינובר', 'יונתן רזאל', 'אייל גולן'];  // אנשי קשר במערכת

        // פונקציה להשמעת צליל (עבור אישור וכישלון)
        function playSound(success) {
            const audio = new Audio(success ? 'https://www.soundjay.com/button/beep-07.wav' : 'https://www.soundjay.com/button/beep-08b.wav');
            audio.play();
        }

        // הפעלת זיהוי דיבור
        function startSpeechRecognition() {
            if (!('webkitSpeechRecognition' in window)) {
                alert("הדפדפן שלך לא תומך בזיהוי דיבור");
                return;
            }

            recognition = new webkitSpeechRecognition();
            recognition.lang = 'he-IL'; // הגדרת השפה לעברית
            recognition.continuous = false; // לא לאפשר זיהוי רצוף
            recognition.interimResults = true; // להציג תוצאות בזמן אמת
            recognition.maxAlternatives = 1; // מקסימום אפשרויות תוצאה

            recognition.onresult = function(event) {
                let transcript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    transcript += event.results[i][0].transcript;
                }
                transcriptDiv.textContent = 'הטקסט עד כה: ' + transcript;

                // אם המילה "טלפון" מופיעה בטקסט, נשמיע צליל ונבקש שם איש קשר
                if (transcript.includes("טלפון")) {
                    playSound(true);  // צליל אישור
                    transcriptDiv.textContent += "\n\nלמי תרצה להתקשר?";
                    startListeningForContactName();
                }
            };

            recognition.start();
        }

        // התחלת האזנה לשם איש קשר
        function startListeningForContactName() {
            recognitionActive = true;
            setTimeout(() => {
                recognition.stop();
                const userName = transcriptDiv.textContent.split('הטקסט עד כה: ').pop();
                const matchedContact = contacts.find(contact => getLevenshteinDistance(contact, userName) < contact.length * 0.2);
                if (matchedContact) {
                    playSound(true);  // צליל הצלחה
                    transcriptDiv.textContent = `מתקשר ל: ${matchedContact}`;
                } else {
                    playSound(false);  // צליל כישלון
                    transcriptDiv.textContent = 'נסה שוב';
                    startListeningForContactName();
                }
            }, 8000);  // 8 שניות האזנה
        }

        // פונקציה לחישוב המרחק של לווינשטיין (Levenshtein Distance)
        function getLevenshteinDistance(a, b) {
            const tmp = [];
            for (let i = 0; i <= b.length; i++) tmp[i] = [i];
            for (let i = 0; i <= a.length; i++) tmp[0][i] = i;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    tmp[i][j] = (b[i - 1] === a[j - 1]) ? tmp[i - 1][j - 1] : Math.min(tmp[i - 1][j - 1] + 1, Math.min(tmp[i][j - 1] + 1, tmp[i - 1][j] + 1));
                }
            }
            return tmp[b.length][a.length];
        }

        // מתחילים את הזיהוי כשהמשתמש אומר "טלפון"
        function startListeningForPhone() {
            if (!recognitionActive) {
                startSpeechRecognition();
            }
        }

        // אתחול הזיהוי בתחילת
        startListeningForPhone();
    </script>
</body>
</html>
