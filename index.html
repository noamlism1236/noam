<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Trainer</title>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Josefin Sans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .header {
            padding: 20px;
            background-color: #007BFF;
            color: white;
            position: relative;
        }
        .home-btn {
            position: absolute;
            left: 10px;
            top: 10px;
            background-color: #ff4b5c;
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .container {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .btn {
            background-color: #007BFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .hidden {
            display: none;
        }
        .input-area {
            width: 80%;
            height: 150px;
            font-size: 18px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .animated {
            animation-duration: 0.5s;
            animation-timing-function: ease-out;
        }
        .fadeIn {
            animation-name: fadeIn;
        }
        .fadeOut {
            animation-name: fadeOut;
        }
        @keyframes fadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }
        @keyframes fadeOut {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Vocabulary Trainer</h1>
        <button class="home-btn" onclick="showHome()">Home</button>
    </div>
    
    <div id="homeScreen" class="container animated fadeIn">
        <button class="btn" onclick="showCreateListScreen()">Create New List</button>
        <button class="btn" onclick="showSavedLists()">View Saved Lists</button>
        <div id="savedListsContainer" class="hidden"></div>
    </div>
    
    <div id="createListScreen" class="container hidden animated fadeIn">
        <h2>Enter List Name</h2>
        <input type="text" id="listNameInput" placeholder="List Name">
        <button class="btn" onclick="createList()">Create List</button>
    </div>
    
    <div id="addWordsScreen" class="container hidden animated fadeIn">
        <h2>Add Words to Your List</h2>
        <textarea id="wordInput" class="input-area" placeholder="Enter words and definitions..."></textarea>
        <button class="btn" onclick="saveAndStartTest()">Save & Start Test</button>
    </div>
    
    <div id="quizScreen" class="container hidden animated fadeIn">
        <h2 id="quizQuestion"></h2>
        <input type="text" id="userAnswer" placeholder="Your answer">
        <button class="btn" onclick="checkAnswer()">Submit</button>
        <p id="feedback"></p>
    </div>

    <div id="resultScreen" class="container hidden animated fadeIn">
        <h2>Test Completed!</h2>
        <p id="resultFeedback"></p>
        <button class="btn" onclick="showHome()">Back to Home</button>
    </div>
    
    <script>
        let currentList = {};
        let words = [];
        let currentWordIndex = 0;
        let correctAnswers = 0;
        let savedLists = JSON.parse(localStorage.getItem("savedLists")) || [];

        // אם הנתונים אינם מערך, להמיר אותם למערך מתאים
        if (!Array.isArray(savedLists)) {
            console.warn("Fixing savedLists format:", savedLists);
            savedLists = [];
            localStorage.setItem("savedLists", JSON.stringify(savedLists));
        }

        // Show Home screen
        function showHome() {
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            const homeScreen = document.getElementById("homeScreen");
            homeScreen.classList.remove("hidden");
            homeScreen.classList.add("animated", "fadeIn");
        }

        // Show Create List screen
        function showCreateListScreen() {
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            const createListScreen = document.getElementById("createListScreen");
            createListScreen.classList.remove("hidden");
            createListScreen.classList.add("animated", "fadeIn");
        }

        // Create a new list
        function createList() {
            const listName = document.getElementById("listNameInput").value.trim();
            if (!listName) {
                alert("Please enter a list name");
                return;
            }
            currentList = { name: listName, words: [] };
            document.getElementById("createListScreen").classList.add("hidden");
            const addWordsScreen = document.getElementById("addWordsScreen");
            addWordsScreen.classList.remove("hidden");
            addWordsScreen.classList.add("animated", "fadeIn");
        }

        // Save the words and start the test
        function saveAndStartTest() {
            try {
                const inputText = document.getElementById("wordInput").value.trim();
                words = inputText.split('\n').map(line => {
                    let parts = line.split(/[:\-]/);
                    return parts.length === 2 ? { word: parts[0].trim(), definition: parts[1].trim() } : null;
                }).filter(item => item);

                if (words.length === 0) {
                    alert("Please enter valid words and definitions.");
                    return;
                }

                currentList.words = words;
                savedLists.push(currentList);
                localStorage.setItem("savedLists", JSON.stringify(savedLists));

                alert("List saved successfully! Starting the test...");
                showHome();
                startTest();
            } catch (error) {
                console.error("Error in saveAndStartTest:", error.message, error.stack);
            }
        }

        // Start the test
        function startTest() {
            if (!words.length) {
                alert("No words in the list to test.");
                return;
            }
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            const quizScreen = document.getElementById("quizScreen");
            quizScreen.classList.remove("hidden");
            quizScreen.classList.add("animated", "fadeIn");
            currentWordIndex = 0;
            correctAnswers = 0; // Reset correct answers counter
            showNextQuestion();
        }

        // Show the next question
        function showNextQuestion() {
            if (currentWordIndex >= words.length) {
                showResult();
                return;
            }
            document.getElementById("quizQuestion").innerText = `What is the definition of: '${words[currentWordIndex].word}'?`;
            document.getElementById("userAnswer").value = "";
            document.getElementById("feedback").innerText = "";
        }

        // Check the user's answer
        function checkAnswer() {
            const userAnswer = document.getElementById("userAnswer").value.trim();
            const correctAnswer = words[currentWordIndex].definition;
            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                correctAnswers++;
                document.getElementById("feedback").innerHTML = "<span style='color:green'>Correct!</span>";
            } else {
                document.getElementById("feedback").innerHTML = `<span style='color:red'>Wrong! The correct answer is: ${correctAnswer}</span>`;
            }
            currentWordIndex++;
            setTimeout(showNextQuestion, 1500);
        }

        // Show result at the end of the test
        function showResult() {
            document.querySelectorAll('.container').forEach(div => div.classList.add('hidden'));
            const resultScreen = document.getElementById("resultScreen");
            resultScreen.classList.remove("hidden");
            resultScreen.classList.add("animated", "fadeIn");

            const resultFeedback = document.getElementById("resultFeedback");
            resultFeedback.innerHTML = `You answered ${correctAnswers} out of ${words.length} questions correctly.`;
        }

        // Show saved lists
        function showSavedLists() {
            try {
                const container = document.getElementById("savedListsContainer");
                container.innerHTML = "";
                container.classList.remove("hidden");

                console.log("Saved lists:", savedLists);

                if (savedLists.length === 0) {
                    container.innerHTML = "<p>No saved lists found.</p>";
                    return;
                }

                savedLists.forEach((list, index) => {
                    const btn = document.createElement("button");
                    btn.className = "btn";
                    btn.innerText = list.name;
                    btn.onclick = function () { loadListForTest(index); };
                    container.appendChild(btn);
                });

            } catch (error) {
                console.error("Error in showSavedLists:", error.message, error.stack);
            }
        }

        // Load a saved list for the test
        function loadListForTest(index) {
            try {
                currentList = savedLists[index];
                words = currentList.words;
                alert(`Loaded list: ${currentList.name}`);
                startTest();
            } catch (error) {
                console.error("Error in loadListForTest:", error.message, error.stack);
            }
        }
    </script>
</body>
</html>
